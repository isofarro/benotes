{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miked/Projects-apps/benotes-app/packages/core/src/schema.ts"],"sourcesContent":["import { sqliteTable, text, integer, primaryKey } from 'drizzle-orm/sqlite-core';\nimport { sql } from 'drizzle-orm';\n\n// --- System Schema (Global) ---\n// Stored in system.db\n\nexport const tenants = sqliteTable('tenants', {\n  id: text('id').primaryKey(),\n  name: text('name').notNull(),\n  slug: text('slug').notNull().unique(), // subdomain or path\n  createdAt: integer('created_at', { mode: 'timestamp' }).default(sql`(strftime('%s', 'now'))`),\n});\n\nexport const users = sqliteTable('users', {\n  id: text('id').primaryKey(),\n  name: text('name'),\n  email: text('email').notNull().unique(),\n  emailVerified: integer('email_verified', { mode: 'timestamp' }),\n  image: text('image'),\n});\n\n// NextAuth Tables (Simplified for now)\nexport const accounts = sqliteTable('accounts', {\n  id: text('id').primaryKey(),\n  userId: text('userId').notNull().references(() => users.id, { onDelete: 'cascade' }),\n  type: text('type').notNull(),\n  provider: text('provider').notNull(),\n  providerAccountId: text('providerAccountId').notNull(),\n  refresh_token: text('refresh_token'),\n  access_token: text('access_token'),\n  expires_at: integer('expires_at'),\n  token_type: text('token_type'),\n  scope: text('scope'),\n  id_token: text('id_token'),\n  session_state: text('session_state'),\n});\n\n// --- Tenant Schema (Per Tenant) ---\n// Stored in tenants/<id>/db.sqlite\n\nexport const pages = sqliteTable('pages', {\n  id: text('id').primaryKey(),\n  title: text('title').notNull(),\n  slug: text('slug').notNull(), // URL friendly\n  content: text('content'), // Markdown body\n  parentId: text('parent_id'), // Hierarchical\n  createdAt: integer('created_at', { mode: 'timestamp' }).default(sql`(strftime('%s', 'now'))`),\n  updatedAt: integer('updated_at', { mode: 'timestamp' }).default(sql`(strftime('%s', 'now'))`),\n});\n\nexport const cards = sqliteTable('cards', {\n  id: text('id').primaryKey(),\n  pageId: text('page_id').references(() => pages.id, { onDelete: 'cascade' }),\n  type: text('type').notNull(), // e.g. 'chess:game', 'core:note'\n  plugin: text('plugin').notNull(), // e.g. 'chess'\n  content: text('content'), // JSON data specific to the card\n  metadata: text('metadata'), // JSON metadata\n  createdAt: integer('created_at', { mode: 'timestamp' }).default(sql`(strftime('%s', 'now'))`),\n});\n\nexport const tags = sqliteTable('tags', {\n  id: text('id').primaryKey(),\n  name: text('name').notNull().unique(),\n  color: text('color'),\n});\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AAAA;AACA;;;AAKO,MAAM,UAAU,IAAA,wKAAW,EAAC,WAAW;IAC5C,IAAI,IAAA,2KAAI,EAAC,MAAM,UAAU;IACzB,MAAM,IAAA,2KAAI,EAAC,QAAQ,OAAO;IAC1B,MAAM,IAAA,2KAAI,EAAC,QAAQ,OAAO,GAAG,MAAM;IACnC,WAAW,IAAA,iLAAO,EAAC,cAAc;QAAE,MAAM;IAAY,GAAG,OAAO,CAAC,mJAAG,CAAC,uBAAuB,CAAC;AAC9F;AAEO,MAAM,QAAQ,IAAA,wKAAW,EAAC,SAAS;IACxC,IAAI,IAAA,2KAAI,EAAC,MAAM,UAAU;IACzB,MAAM,IAAA,2KAAI,EAAC;IACX,OAAO,IAAA,2KAAI,EAAC,SAAS,OAAO,GAAG,MAAM;IACrC,eAAe,IAAA,iLAAO,EAAC,kBAAkB;QAAE,MAAM;IAAY;IAC7D,OAAO,IAAA,2KAAI,EAAC;AACd;AAGO,MAAM,WAAW,IAAA,wKAAW,EAAC,YAAY;IAC9C,IAAI,IAAA,2KAAI,EAAC,MAAM,UAAU;IACzB,QAAQ,IAAA,2KAAI,EAAC,UAAU,OAAO,GAAG,UAAU,CAAC,IAAM,MAAM,EAAE,EAAE;QAAE,UAAU;IAAU;IAClF,MAAM,IAAA,2KAAI,EAAC,QAAQ,OAAO;IAC1B,UAAU,IAAA,2KAAI,EAAC,YAAY,OAAO;IAClC,mBAAmB,IAAA,2KAAI,EAAC,qBAAqB,OAAO;IACpD,eAAe,IAAA,2KAAI,EAAC;IACpB,cAAc,IAAA,2KAAI,EAAC;IACnB,YAAY,IAAA,iLAAO,EAAC;IACpB,YAAY,IAAA,2KAAI,EAAC;IACjB,OAAO,IAAA,2KAAI,EAAC;IACZ,UAAU,IAAA,2KAAI,EAAC;IACf,eAAe,IAAA,2KAAI,EAAC;AACtB;AAKO,MAAM,QAAQ,IAAA,wKAAW,EAAC,SAAS;IACxC,IAAI,IAAA,2KAAI,EAAC,MAAM,UAAU;IACzB,OAAO,IAAA,2KAAI,EAAC,SAAS,OAAO;IAC5B,MAAM,IAAA,2KAAI,EAAC,QAAQ,OAAO;IAC1B,SAAS,IAAA,2KAAI,EAAC;IACd,UAAU,IAAA,2KAAI,EAAC;IACf,WAAW,IAAA,iLAAO,EAAC,cAAc;QAAE,MAAM;IAAY,GAAG,OAAO,CAAC,mJAAG,CAAC,uBAAuB,CAAC;IAC5F,WAAW,IAAA,iLAAO,EAAC,cAAc;QAAE,MAAM;IAAY,GAAG,OAAO,CAAC,mJAAG,CAAC,uBAAuB,CAAC;AAC9F;AAEO,MAAM,QAAQ,IAAA,wKAAW,EAAC,SAAS;IACxC,IAAI,IAAA,2KAAI,EAAC,MAAM,UAAU;IACzB,QAAQ,IAAA,2KAAI,EAAC,WAAW,UAAU,CAAC,IAAM,MAAM,EAAE,EAAE;QAAE,UAAU;IAAU;IACzE,MAAM,IAAA,2KAAI,EAAC,QAAQ,OAAO;IAC1B,QAAQ,IAAA,2KAAI,EAAC,UAAU,OAAO;IAC9B,SAAS,IAAA,2KAAI,EAAC;IACd,UAAU,IAAA,2KAAI,EAAC;IACf,WAAW,IAAA,iLAAO,EAAC,cAAc;QAAE,MAAM;IAAY,GAAG,OAAO,CAAC,mJAAG,CAAC,uBAAuB,CAAC;AAC9F;AAEO,MAAM,OAAO,IAAA,wKAAW,EAAC,QAAQ;IACtC,IAAI,IAAA,2KAAI,EAAC,MAAM,UAAU;IACzB,MAAM,IAAA,2KAAI,EAAC,QAAQ,OAAO,GAAG,MAAM;IACnC,OAAO,IAAA,2KAAI,EAAC;AACd"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Users/miked/Projects-apps/benotes-app/packages/core/src/db.ts"],"sourcesContent":["import Database from 'better-sqlite3';\nimport { drizzle } from 'drizzle-orm/better-sqlite3';\nimport { sql } from 'drizzle-orm';\nimport path from 'path';\nimport fs from 'fs';\nimport * as schema from './schema';\n\n// Environment variable for data directory\nconst DATA_DIR = process.env.DATA_DIR || path.join(process.cwd(), '../../data');\n\n// Ensure data directory exists\nif (!fs.existsSync(DATA_DIR)) {\n  fs.mkdirSync(DATA_DIR, { recursive: true });\n}\n\n// Cache for database connections to avoid reopening\nconst dbCache: Record<string, ReturnType<typeof drizzle>> = {};\n\n/**\n * Get the Global System Database\n * Used for Tenants, Users, Auth\n */\nexport const getSystemDb = () => {\n  if (dbCache['system']) return dbCache['system'];\n\n  const systemDir = path.join(DATA_DIR, 'system');\n  if (!fs.existsSync(systemDir)) {\n    fs.mkdirSync(systemDir, { recursive: true });\n  }\n\n  const sqlite = new Database(path.join(systemDir, 'system.db'));\n  \n  // Bootstrap System Schema (Temporary for Walking Skeleton)\n  sqlite.exec(`\n    CREATE TABLE IF NOT EXISTS tenants (\n      id TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      slug TEXT NOT NULL UNIQUE,\n      created_at INTEGER\n    );\n    CREATE TABLE IF NOT EXISTS users (\n      id TEXT PRIMARY KEY,\n      name TEXT,\n      email TEXT NOT NULL UNIQUE,\n      email_verified INTEGER,\n      image TEXT\n    );\n  `);\n\n  const db = drizzle(sqlite, { schema });\n  dbCache['system'] = db;\n  return db;\n};\n\n/**\n * Get a specific Tenant Database\n * Used for Pages, Cards, Plugins\n */\nexport const getTenantDb = (tenantId: string) => {\n  if (dbCache[tenantId]) return dbCache[tenantId];\n\n  const tenantDir = path.join(DATA_DIR, 'tenants', tenantId);\n  if (!fs.existsSync(tenantDir)) {\n    fs.mkdirSync(tenantDir, { recursive: true });\n  }\n\n  const sqlite = new Database(path.join(tenantDir, 'db.sqlite'));\n\n  // Bootstrap Tenant Schema (Temporary for Walking Skeleton)\n  sqlite.exec(`\n    CREATE TABLE IF NOT EXISTS pages (\n      id TEXT PRIMARY KEY,\n      title TEXT NOT NULL,\n      slug TEXT NOT NULL,\n      content TEXT,\n      parent_id TEXT,\n      created_at INTEGER,\n      updated_at INTEGER\n    );\n    CREATE TABLE IF NOT EXISTS cards (\n      id TEXT PRIMARY KEY,\n      page_id TEXT,\n      type TEXT NOT NULL,\n      plugin TEXT NOT NULL,\n      content TEXT,\n      metadata TEXT,\n      created_at INTEGER,\n      FOREIGN KEY (page_id) REFERENCES pages(id) ON DELETE CASCADE\n    );\n    CREATE TABLE IF NOT EXISTS tags (\n      id TEXT PRIMARY KEY,\n      name TEXT NOT NULL UNIQUE,\n      color TEXT\n    );\n  `);\n\n  const db = drizzle(sqlite, { schema });\n  dbCache[tenantId] = db;\n  return db;\n};\n\n/**\n * Helper to initialize a new tenant\n */\nexport const initTenant = (tenantId: string, name: string) => {\n    // 1. Create entry in System DB\n    const systemDb = getSystemDb();\n    \n    // Check if exists or Insert\n    // We use raw SQL for speed in this skeleton, or Drizzle\n    try {\n      systemDb.insert(schema.tenants).values({\n        id: tenantId,\n        name: name,\n        slug: tenantId\n      }).onConflictDoNothing().run();\n    } catch (e) {\n      console.error(\"Failed to register tenant in system DB\", e);\n    }\n    \n    // 2. Initialize Tenant DB (creates tables)\n    const db = getTenantDb(tenantId);\n    return db;\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAEA;AACA;AACA;;;;;;AAEA,0CAA0C;AAC1C,MAAM,WAAW,QAAQ,GAAG,CAAC,QAAQ,IAAI,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAElE,+BAA+B;AAC/B,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,WAAW;IAC5B,wGAAE,CAAC,SAAS,CAAC,UAAU;QAAE,WAAW;IAAK;AAC3C;AAEA,oDAAoD;AACpD,MAAM,UAAsD,CAAC;AAMtD,MAAM,cAAc;IACzB,IAAI,OAAO,CAAC,SAAS,EAAE,OAAO,OAAO,CAAC,SAAS;IAE/C,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,UAAU;IACtC,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,YAAY;QAC7B,wGAAE,CAAC,SAAS,CAAC,WAAW;YAAE,WAAW;QAAK;IAC5C;IAEA,MAAM,SAAS,IAAI,8LAAQ,CAAC,4GAAI,CAAC,IAAI,CAAC,WAAW;IAEjD,2DAA2D;IAC3D,OAAO,IAAI,CAAC,CAAC;;;;;;;;;;;;;;EAcb,CAAC;IAED,MAAM,KAAK,IAAA,wKAAO,EAAC,QAAQ;QAAE,QAAA;IAAO;IACpC,OAAO,CAAC,SAAS,GAAG;IACpB,OAAO;AACT;AAMO,MAAM,cAAc,CAAC;IAC1B,IAAI,OAAO,CAAC,SAAS,EAAE,OAAO,OAAO,CAAC,SAAS;IAE/C,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,UAAU,WAAW;IACjD,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,YAAY;QAC7B,wGAAE,CAAC,SAAS,CAAC,WAAW;YAAE,WAAW;QAAK;IAC5C;IAEA,MAAM,SAAS,IAAI,8LAAQ,CAAC,4GAAI,CAAC,IAAI,CAAC,WAAW;IAEjD,2DAA2D;IAC3D,OAAO,IAAI,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;EAyBb,CAAC;IAED,MAAM,KAAK,IAAA,wKAAO,EAAC,QAAQ;QAAE,QAAA;IAAO;IACpC,OAAO,CAAC,SAAS,GAAG;IACpB,OAAO;AACT;AAKO,MAAM,aAAa,CAAC,UAAkB;IACzC,+BAA+B;IAC/B,MAAM,WAAW;IAEjB,4BAA4B;IAC5B,wDAAwD;IACxD,IAAI;QACF,SAAS,MAAM,CAAC,4IAAc,EAAE,MAAM,CAAC;YACrC,IAAI;YACJ,MAAM;YACN,MAAM;QACR,GAAG,mBAAmB,GAAG,GAAG;IAC9B,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,0CAA0C;IAC1D;IAEA,2CAA2C;IAC3C,MAAM,KAAK,YAAY;IACvB,OAAO;AACX"}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///Users/miked/Projects-apps/benotes-app/packages/core/src/index.ts"],"sourcesContent":["export * from './schema';\nexport * from './db';\n"],"names":[],"mappings":";AAAA;AACA"}},
    {"offset": {"line": 236, "column": 0}, "map": {"version":3,"sources":["file:///Users/miked/Projects-apps/benotes-app/apps/web/app/page.tsx"],"sourcesContent":["import { getSystemDb, initTenant, getTenantDb, pages } from '@benotes/core';\nimport { revalidatePath } from 'next/cache';\nimport { randomUUID } from 'crypto';\n\nexport default async function Home() {\n  // Ensure tenant exists\n  initTenant('demo', 'Demo Tenant');\n  const db = getTenantDb('demo');\n  \n  // Fetch pages\n  const allPages = db.select().from(pages).all();\n\n  // Server Action\n  async function createPage(formData: FormData) {\n    'use server';\n    const title = formData.get('title') as string;\n    if (!title) return;\n    \n    const db = getTenantDb('demo');\n    db.insert(pages).values({\n      id: randomUUID(),\n      title,\n      slug: title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, ''),\n      content: '',\n      createdAt: new Date(),\n      updatedAt: new Date()\n    }).run();\n    \n    revalidatePath('/');\n  }\n\n  return (\n    <main className=\"p-8 max-w-4xl mx-auto\">\n      <h1 className=\"text-3xl font-bold mb-8\">Benotes</h1>\n      \n      <div className=\"bg-white p-6 rounded-lg shadow mb-8\">\n        <h2 className=\"text-xl font-semibold mb-4\">Create New Page</h2>\n        <form action={createPage} className=\"flex gap-2\">\n          <input \n            name=\"title\" \n            placeholder=\"Page Title\" \n            className=\"flex-1 border border-gray-300 p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            required\n          />\n          <button \n            type=\"submit\" \n            className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors\"\n          >\n            Create\n          </button>\n        </form>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h2 className=\"text-xl font-semibold\">Your Pages ({allPages.length})</h2>\n        {allPages.length === 0 ? (\n          <p className=\"text-gray-500 italic\">No pages yet. Create one above.</p>\n        ) : (\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            {allPages.map(page => (\n              <div key={page.id} className=\"p-4 border border-gray-200 rounded hover:shadow-md transition-shadow\">\n                <h3 className=\"font-bold text-lg\">{page.title}</h3>\n                <p className=\"text-sm text-gray-500 font-mono mt-1\">/{page.slug}</p>\n                <div className=\"text-xs text-gray-400 mt-2\">\n                  Created: {new Date(page.createdAt!).toLocaleDateString()}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;;;;+HAAA;AAAA;AAAA;AACA;AACA;;;;;;MAUE,gBAAgB;AAChB,wBAAA,eAAe,WAAW,QAAkB;IAE1C,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,IAAI,CAAC,OAAO;IAEZ,MAAM,KAAK,IAAA,4IAAW,EAAC;IACvB,GAAG,MAAM,CAAC,0IAAK,EAAE,MAAM,CAAC;QACtB,IAAI,IAAA,mHAAU;QACd;QACA,MAAM,MAAM,WAAW,GAAG,OAAO,CAAC,eAAe,KAAK,OAAO,CAAC,UAAU;QACxE,SAAS;QACT,WAAW,IAAI;QACf,WAAW,IAAI;IACjB,GAAG,GAAG;IAEN,IAAA,+IAAc,EAAC;AACjB;+OAhBA;AATa,eAAe;IAC5B,uBAAuB;IACvB,IAAA,2IAAU,EAAC,QAAQ;IACnB,MAAM,KAAK,IAAA,4IAAW,EAAC;IAEvB,cAAc;IACd,MAAM,WAAW,GAAG,MAAM,GAAG,IAAI,CAAC,0IAAK,EAAE,GAAG;QAG7B,aAAf;IAkBA,qBACE,8OAAC;QAAK,WAAU;;0BACd,8OAAC;gBAAG,WAAU;0BAA0B;;;;;;0BAExC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAA6B;;;;;;kCAC3C,8OAAC;wBAAK,QAAQ;wBAAY,WAAU;;0CAClC,8OAAC;gCACC,MAAK;gCACL,aAAY;gCACZ,WAAU;gCACV,QAAQ;;;;;;0CAEV,8OAAC;gCACC,MAAK;gCACL,WAAU;0CACX;;;;;;;;;;;;;;;;;;0BAML,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;;4BAAwB;4BAAa,SAAS,MAAM;4BAAC;;;;;;;oBAClE,SAAS,MAAM,KAAK,kBACnB,8OAAC;wBAAE,WAAU;kCAAuB;;;;;6CAEpC,8OAAC;wBAAI,WAAU;kCACZ,SAAS,GAAG,CAAC,CAAA,qBACZ,8OAAC;gCAAkB,WAAU;;kDAC3B,8OAAC;wCAAG,WAAU;kDAAqB,KAAK,KAAK;;;;;;kDAC7C,8OAAC;wCAAE,WAAU;;4CAAuC;4CAAE,KAAK,IAAI;;;;;;;kDAC/D,8OAAC;wCAAI,WAAU;;4CAA6B;4CAChC,IAAI,KAAK,KAAK,SAAS,EAAG,kBAAkB;;;;;;;;+BAJhD,KAAK,EAAE;;;;;;;;;;;;;;;;;;;;;;AAa/B"}},
    {"offset": {"line": 419, "column": 0}, "map": {"version":3,"sources":["file:///Users/miked/Projects-apps/benotes-app/apps/web/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {$$RSC_SERVER_ACTION_0 as '405677897d0a9b9d075f8a55ff3df3fc648e99f06f'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}